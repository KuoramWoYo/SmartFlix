<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login e Cadastro</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .screen { display: none; }
        #loginScreen, #cadastroScreen { display: block; }
    </style>
</head>
<body>
    <!-- Tela de Cadastro -->
    <div id="cadastroScreen" class="screen">
        <h2>Cadastrar</h2>
        <input type="email" id="emailCadastro" placeholder="E-mail" required><br>
        <input type="password" id="senhaCadastro" placeholder="Senha" required><br>
        <button onclick="cadastrarUsuario()">Criar conta</button>
        <button onclick="mostrarLogin()">Já tenho uma conta</button>
    </div>

    <!-- Tela de Login -->
    <div id="loginScreen" class="screen">
        <h2>Login</h2>
        <input type="email" id="emailLogin" placeholder="E-mail" required><br>
        <input type="password" id="senhaLogin" placeholder="Senha" required><br>
        <button onclick="loginUsuario()">Entrar</button>
        <button onclick="mostrarCadastro()">Criar conta</button>
    </div>

    <!-- Tela de Admin -->
    <div id="adminScreen" class="screen">
        <h2>Admin</h2>
        <p>Bem-vindo à área administrativa!</p>
        <button onclick="logout()">Sair</button>
        <h3>Função de Admin:</h3>
        <p>Apenas o admin pode usar essa função!</p>
        <label for="uidAdmin">Insira o UID do admin para acessar:</label><br>
        <input type="text" id="uidAdmin" placeholder="UID do Admin"><br>
        <button onclick="verificarUID()">Verificar UID</button>
    </div>

    <!-- Tela de Usuário Comum -->
    <div id="userScreen" class="screen">
        <h2>Usuário Comum</h2>
        <p>Bem-vindo ao seu perfil!</p>
        <button onclick="logout()">Sair</button>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCagqHkM1hi6ppzNjs1n_9Q6grM6vKNIkw",
            authDomain: "smartflix-2897c.firebaseapp.com",
            projectId: "smartflix-2897c",
            storageBucket: "smartflix-2897c.firebasestorage.app",
            messagingSenderId: "40417251997",
            appId: "1:40417251997:web:4c12974a0dba3965767a74",
            measurementId: "G-4BZKY8RJZS"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const firestore = firebase.firestore();

        // Exibe a tela de cadastro
        function mostrarCadastro() {
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("cadastroScreen").style.display = "block";
        }

        // Exibe a tela de login
        function mostrarLogin() {
            document.getElementById("cadastroScreen").style.display = "none";
            document.getElementById("loginScreen").style.display = "block";
        }

        // Função de cadastro
        function cadastrarUsuario() {
            const email = document.getElementById("emailCadastro").value;
            const senha = document.getElementById("senhaCadastro").value;

            firebase.auth().createUserWithEmailAndPassword(email, senha)
                .then((userCredential) => {
                    const user = userCredential.user;
                    let isAdmin = false;

                    // Armazenar no Firestore com o campo isAdmin
                    firestore.collection("usuarios").doc(user.uid).set({
                        email: user.email,
                        displayName: user.email.split("@")[0],  // Usando o e-mail para o nome
                        isAdmin: false,  // Inicialmente, todos são comuns
                        banido: false
                    }).then(() => {
                        alert("Conta criada com sucesso!");
                        mostrarLogin();
                    });
                })
                .catch((error) => {
                    alert("Erro ao criar conta: " + error.message);
                });
        }

        // Função de login
        function loginUsuario() {
            const email = document.getElementById("emailLogin").value;
            const senha = document.getElementById("senhaLogin").value;

            firebase.auth().signInWithEmailAndPassword(email, senha)
                .then((userCredential) => {
                    const user = userCredential.user;
                    verificarSeAdmin(user);
                })
                .catch((error) => {
                    alert("Erro ao fazer login: " + error.message);
                });
        }

        // Função de verificação de admin
        function verificarSeAdmin(user) {
            firestore.collection("usuarios").doc(user.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const usuarioData = doc.data();
                        if (usuarioData.isAdmin) {
                            // Se for admin, exibe tela de admin
                            document.getElementById("loginScreen").style.display = "none";
                            document.getElementById("adminScreen").style.display = "block";
                        } else {
                            // Se for usuário comum, exibe tela de usuário
                            document.getElementById("loginScreen").style.display = "none";
                            document.getElementById("userScreen").style.display = "block";
                        }
                    }
                })
                .catch((error) => {
                    alert("Erro ao verificar dados do usuário: " + error.message);
                });
        }

        // Função de logout
        function logout() {
            firebase.auth().signOut().then(() => {
                document.getElementById("adminScreen").style.display = "none";
                document.getElementById("userScreen").style.display = "none";
                mostrarLogin();
            }).catch((error) => {
                alert("Erro ao sair: " + error.message);
            });
        }

        // Função de verificação do UID (Admin)
        function verificarUID() {
            const uid = document.getElementById("uidAdmin").value;

            firebase.firestore().collection("usuarios").doc(uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.isAdmin) {
                            alert("Você é o admin!");
                            document.getElementById("adminScreen").style.display = "block";
                        } else {
                            alert("Este UID não corresponde a um admin.");
                        }
                    } else {
                        alert("UID não encontrado.");
                    }
                })
                .catch((error) => {
                    alert("Erro ao verificar UID: " + error.message);
                });
        }
    </script>
</body>
</html>
